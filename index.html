<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Fisioterapia - Análise de Atendimentos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://code.jquery.com">
    <link rel="preconnect" href="https://cdn.datatables.net">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <link rel="stylesheet" href="styles/tokens.css">
    <link rel="stylesheet" href="styles/theme.css">
</head>
<body>
    <a href="#conteudo" class="skip-link">Pular para o conteúdo</a>
    <header class="page-hero">
        <div class="container">
            <div class="hero-content">
                <h1>Dashboard de Atendimentos de Fisioterapia</h1>
                <p>Explore os indicadores-chave, tendências e distribuição geográfica dos atendimentos de 2020 a 2024 para tomar decisões estratégicas com mais confiança.</p>
            </div>
        </div>
    </header>

    <main id="conteudo" class="container-fluid mt-4">
        <section class="card filters-card is-open" id="filtersCard">
            <div class="card-header">
                <h4><i class="fas fa-filter" aria-hidden="true"></i> Filtros</h4>
                <button type="button" class="filters-toggle" id="filtersToggle" aria-expanded="true" aria-controls="filtersPanel">
                    <span>Ocultar filtros</span>
                    <i class="fas fa-chevron-up" aria-hidden="true"></i>
                </button>
            </div>
            <div class="card-body" id="filtersPanel">
                <form id="filtersForm" class="filters-layout" autocomplete="off">
                    <div class="filters-field">
                        <label class="filters-label" for="ano-select">Ano</label>
                        <select id="ano-select" name="ano" aria-label="Selecionar ano"></select>
                    </div>
                    <div class="filters-field">
                        <label class="filters-label" for="bairro-select">Bairros</label>
                        <select id="bairro-select" name="bairros" multiple aria-describedby="bairroHelp" aria-label="Selecionar bairros"></select>
                        <p class="sr-only" id="bairroHelp">Selecione um ou mais bairros para filtrar.</p>
                    </div>
                    <div class="filters-field filters-actions">
                        <button type="submit" class="btn btn-primary" id="apply-filters" disabled>
                            <i class="fas fa-play" aria-hidden="true"></i>
                            Aplicar filtros
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-filters">
                            <i class="fas fa-undo" aria-hidden="true"></i>
                            Limpar
                        </button>
                    </div>
                </form>
                <div>
                    <div class="filters-label">Filtros ativos</div>
                    <div class="active-filters is-empty" id="activeFilters" role="status" aria-live="polite">
                        Nenhum filtro aplicado
                    </div>
                </div>
                <div class="alert-inline" id="filtersFeedback" role="status" aria-live="polite">
                    Carregando dados iniciais...
                </div>
            </div>
        </section>

        <section class="kpi-grid" aria-label="Indicadores principais">
            <article class="kpi-card" aria-live="polite">
                <div class="kpi-icon" aria-hidden="true"><i class="fas fa-hands-helping"></i></div>
                <span class="kpi-title">Total de atendimentos</span>
                <span class="kpi-value" id="kpi-atendimentos"><span class="skeleton"></span></span>
                <span class="kpi-trend" id="kpi-atendimentos-trend"></span>
                <span class="kpi-caption">Somatório no período selecionado</span>
            </article>
            <article class="kpi-card" aria-live="polite">
                <div class="kpi-icon" aria-hidden="true"><i class="fas fa-user-friends"></i></div>
                <span class="kpi-title">Pacientes únicos</span>
                <span class="kpi-value" id="kpi-pacientes"><span class="skeleton"></span></span>
                <span class="kpi-trend" id="kpi-pacientes-trend"></span>
                <span class="kpi-caption">Total de pacientes distintos atendidos</span>
            </article>
            <article class="kpi-card" aria-live="polite">
                <div class="kpi-icon" aria-hidden="true"><i class="fas fa-chart-line"></i></div>
                <span class="kpi-title">Média de atend./paciente</span>
                <span class="kpi-value" id="kpi-media"><span class="skeleton"></span></span>
                <span class="kpi-caption">Indicador de frequência média de sessões</span>
            </article>
            <article class="kpi-card" aria-live="polite">
                <div class="kpi-icon" aria-hidden="true"><i class="fas fa-map-marker-alt"></i></div>
                <span class="kpi-title">Bairros atendidos</span>
                <span class="kpi-value" id="kpi-bairros"><span class="skeleton"></span></span>
                <span class="kpi-caption">Bairros únicos no recorte atual</span>
            </article>
        </section>

        <section class="card map-card mt-5" aria-labelledby="mapaSectionTitle">
            <div class="card-header">
                <h4 id="mapaSectionTitle"><i class="fas fa-map-marked-alt" aria-hidden="true"></i> Cobertura geográfica</h4>
            </div>
            <div class="card-body">
                <p>Visualize a concentração de atendimentos e pacientes por bairro no mapa interativo dedicado.</p>
                <div>
                    <a class="btn btn-primary" href="mapa_bairros_filter.html" target="_blank" rel="noopener">
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                        Abrir mapa interativo
                    </a>
                </div>
            </div>
        </section>

        <section class="charts-grid mt-5" aria-label="Visualizações de desempenho">
            <article class="card chart-card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-line" aria-hidden="true"></i> Evolução dos atendimentos por ano</h5>
                </div>
                <div class="card-body">
                    <div class="chart-wrapper">
                        <div class="chart-loading is-visible" id="chartAtendimentosLoading" aria-hidden="true">
                            <span class="spinner" aria-hidden="true"></span>
                        </div>
                        <canvas id="chart-atendimentos-ano" aria-label="Gráfico de atendimentos por ano" role="img"></canvas>
                    </div>
                </div>
            </article>
            <article class="card chart-card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar" aria-hidden="true"></i> Top 10 bairros por atendimentos</h5>
                </div>
                <div class="card-body">
                    <div class="chart-wrapper">
                        <div class="chart-loading is-visible" id="chartTopBairrosLoading" aria-hidden="true">
                            <span class="spinner" aria-hidden="true"></span>
                        </div>
                        <canvas id="chart-top-bairros" aria-label="Top bairros por atendimentos" role="img"></canvas>
                    </div>
                </div>
            </article>
        </section>

        <section class="card table-card mt-5" aria-label="Tabela detalhada de atendimentos">
            <div class="card-header">
                <h5><i class="fas fa-table" aria-hidden="true"></i> Dados detalhados por bairro (Top 20)</h5>
            </div>
            <div class="card-body position-relative">
                <div class="table-loading is-visible" id="tableLoading" aria-hidden="true">
                    <span class="spinner" aria-hidden="true"></span>
                </div>
                <div class="table-responsive">
                    <table id="data-table" class="table table-striped table-hover" role="table" aria-describedby="tableCaption">
                        <caption id="tableCaption" class="sr-only">Tabela com indicadores de atendimentos, pacientes e variação por bairro e ano.</caption>
                        <thead>
                            <tr>
                                <th>Ano</th>
                                <th>Bairro</th>
                                <th>Atendimentos</th>
                                <th>Pacientes únicos</th>
                                <th>Δ Atendimentos</th>
                                <th>Δ %</th>
                                <th>Participação (%)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center py-4 mt-5">
        <div class="container">
            <p class="mb-1">&copy; 2025 Dashboard Fisioterapia. Análise de dados de atendimentos por bairro.</p>
            <small>Dados referentes ao período de 2020-2024.</small>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js" defer></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js" defer></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js" defer></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js" defer></script>
    <script>
      if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
        window.API_BASE_URL = window.API_BASE_URL || 'http://localhost:8000';
      } else {
        window.API_BASE_URL = '';
      }
    </script>
    <script src="assets/js/data.js" defer></script>
    <script src="assets/js/charts.js" defer></script>
    <script src="assets/js/app.js" defer></script>
</body>
</html>
