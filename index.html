<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Fisioterapia - An√°lise de Atendimentos</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://code.jquery.com">
    <link rel="preconnect" href="https://cdn.datatables.net">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/tokens.css">
    <link rel="stylesheet" href="styles/theme.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <style>
        .kpi-card {
            background: var(--color-surface);
            color: var(--color-text);
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow);
        }
        .kpi-number {
            font-size: 2.2rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-2);
        }
        .kpi-label {
            font-size: 1rem;
            color: var(--color-muted);
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: var(--space-6);
        }
        .card {
            border: none;
            box-shadow: var(--shadow);
            border-radius: var(--radius);
        }
        .card-header {
            background: var(--color-surface-2);
            border-bottom: 2px solid rgba(255,255,255,.06);
            font-weight: 600;
        }
        .table th {
            background-color: var(--color-surface-2);
            font-weight: 600;
        }
        .btn-map {
            background: var(--color-primary);
            border: none;
            border-radius: 9999px;
            padding: 12px 25px;
            font-weight: 600;
            color: #fff;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }
        .btn-map:hover {
            transform: translateY(-2px);
            color: #fff;
        }
    </style>
</head>
<body>
    <a href="#conteudo" class="skip-link">Pular para o conte√∫do</a>
    <header class="bg-primary text-white text-center py-4">
        <div class="container">
            <h1 class="display-4">Dashboard de Atendimentos de Fisioterapia</h1>
            <p class="lead">An√°lise Completa por Bairro e Ano (2020-2024)</p>
        </div>
    </header>

    <main id="conteudo" class="container-fluid mt-4">
        <nav class="filters mb-3" aria-label="Filtros do dashboard">
            <form id="filtersForm">
                <div>
                    <label for="ano-select">Ano</label>
                    <select id="ano-select" name="ano"></select>
                </div>
                <div>
                    <label for="bairro-select">Bairro</label>
                    <select id="bairro-select" name="bairro" multiple aria-describedby="bairroHelp"></select>
                    <small id="bairroHelp" class="sr-only">Selecione um ou mais bairros para filtrar.</small>
                </div>
                <div>
                    <button type="submit" class="btn btn-primary">Aplicar</button>
                    <button type="button" id="reset-filters" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
            <div id="filtersFeedback" aria-live="polite" aria-atomic="true" class="sr-only"></div>
        </nav>
        <!-- KPIs -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="kpi-card text-center">
                    <div class="kpi-number" id="kpi-atendimentos">0</div>
                    <div class="kpi-label">Total de Atendimentos</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card text-center">
                    <div class="kpi-number" id="kpi-pacientes">0</div>
                    <div class="kpi-label">Total de Pacientes √önicos</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card text-center">
                    <div class="kpi-number" id="kpi-media">0</div>
                    <div class="kpi-label">M√©dia Atend./Paciente</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card text-center">
                    <div class="kpi-number" id="kpi-bairros">0</div>
                    <div class="kpi-label">Bairros Atendidos</div>
                </div>
            </div>
        </div>

        <!-- Mapa -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <a href="mapa_bairros_filter.html" target="_blank" class="btn-map">
                    üó∫Ô∏è Visualizar Mapa Interativo dos Bairros
                </a>
            </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line"></i> Evolu√ß√£o dos Atendimentos por Ano</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="chart-atendimentos-ano" aria-label="Gr√°fico de atendimentos por ano" role="img"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-bar"></i> Top 10 Bairros por Atendimentos</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="chart-top-bairros" aria-label="Top bairros por atendimentos" role="img"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- An√°lise YoY removida: ser√° derivada futuramente do CSV -->

        <!-- Tabela Detalhada -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-table"></i> Dados Detalhados por Bairro (Top 20)</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="data-table" class="table table-striped table-hover" role="table">
                                <thead>
                                    <tr>
                                        <th>Ano</th>
                                        <th>Bairro</th>
                                        <th>Atendimentos</th>
                                        <th>Pacientes √önicos</th>
                                        <th>Œî Atendimentos</th>
                                        <th>Œî %</th>
                                        <th>Participa√ß√£o (%)</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-detalhada">
                                    <!-- Dados ser√£o inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2025 Dashboard Fisioterapia. An√°lise de dados de atendimentos por bairro.</p>
            <small class="text-muted">Dados referentes ao per√≠odo de 2020-2024</small>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script>
      window.API_BASE_URL = window.API_BASE_URL || 'http://localhost:8000';
    </script>
    <script src="assets/js/data.js" defer></script>
    <script src="assets/js/charts.js" defer></script>
    <script src="assets/js/app.js" defer></script>
    <script>
    document.getElementById('filtersForm').addEventListener('submit',(e)=>{
      e.preventDefault();
      const ano = document.getElementById('ano-select').value || 'Todos os anos';
      const bairros = Array.from(document.getElementById('bairro-select').selectedOptions).map(o=>o.value);
      document.getElementById('filtersFeedback').textContent = `Filtros aplicados: ${ano}; ${bairros.length? bairros.join(', '):'todos os bairros'}. Atualizando gr√°ficos e tabela...`;
      updateDashboard();
    });
    document.getElementById('reset-filters').addEventListener('click', ()=>{
      document.getElementById('filtersFeedback').textContent = 'Filtros limpos. Mostrando dados completos.';
        });
    </script>
</body>
</html>

